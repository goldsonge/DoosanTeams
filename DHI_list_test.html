<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Toggle Row Expansion with Conditional Button</title>
<style>
  /* Container styling */
  .table-container {
    width: 100%;
    font-family: Arial, sans-serif;
  }

  /* Row and cell styling */
  .table-row {
    display: flex;
    align-items: center;
    border-bottom: 1px solid #ddd;
    padding: 10px;
    transition: all 0.3s ease;
  }

  .table-cell {
    flex: 1;
    padding: 8px;
  }

  /* Button styling */
  .toggle-button, .edit-button, .save-button, .cancel-button {
    cursor: pointer;
    background-color: #9b59b6; /* purple */
    color: white;
    border: none;
    border-radius: 4px;
    padding: 5px 10px;
    margin: 0 5px;
  }

  .toggle-button:hover, .edit-button:hover, .save-button:hover, .cancel-button:hover {
    background-color: #8e44ad;
  }

  /* Hidden button styling */
  .save-button, .cancel-button {
    display: none;
  }

  /* Expanded row styling */
  .table-row.expanded {
    align-items: flex-start;
    background-color: #f9f9f9;
  }

  .expanded-content {
    display: none;
    flex-direction: column;
    width: 100%;
    margin-top: 10px;
  }

  .table-row.expanded .expanded-content {
    display: flex;
  }

  .expanded-input {
    width: 100%;
    padding: 5px;
    font-size: 14px;
    margin-top: 5px;
  }

  .radio-group {
    display: flex;
    gap: 10px;
  }

  .radio-group label {
    font-size: 14px;
    margin-right: 5px;
  }
</style>
</head>
<body>

<div class="table-container">
  <!-- Table Header -->
  <div class="table-row">
    <div class="table-cell">조항</div>
    <div class="table-cell">분석항목</div>
    <div class="table-cell">AI 의견</div>
    <div class="table-cell">부서</div>
    <div class="table-cell">상태</div>
    <div class="table-cell">담당자 의견</div>
    <div class="table-cell">작성자</div>
    <div class="table-cell">작성일</div>
    <div class="table-cell">액션</div>
  </div>

  <!-- Table Row Example with Toggle Expandable Content -->
  <div class="table-row">
    <div class="table-cell">60.6</div>
    <div class="table-cell">항목 설명4 항목 설명4 항목 설명4...</div>
    <div class="table-cell">AI 의견 예시 AI 의견 예시...</div>
    <div class="table-cell" data-default="부서명">부서명</div>
    <div class="table-cell" data-default="검토필요">검토필요</div>
    <div class="table-cell" data-default="담당자 의견 작성">담당자 의견 작성...</div>
    <div class="table-cell" data-default="김피코">김피코</div>
    <div class="table-cell" data-default="2024-09-05 11:00">2024-09-05 11:00</div>
    <div class="table-cell">
      <!--<button class="toggle-button" onclick="toggleRow(this)">+ 담당자 의견 추가</button>-->
      <button class="toggle-button edit-button" onclick="toggleRow(this)">✎</button>
      <button class="save-button" onclick="saveContent(this)">저장</button>
      <button class="cancel-button" onclick="cancelEdit(this)">취소</button>
    </div>

    <!-- Expandable Content in the Same Row -->
    <div class="expanded-content">
      <input type="text" class="expanded-input department-input" placeholder="부서명을 입력하세요">
      
      <!-- Status Radio Button Group -->
      <div class="expanded-input radio-group">
        <label>상태:</label>
        <label><input type="radio" name="status" value="PASS"> PASS</label>
        <label><input type="radio" name="status" value="FAIL"> FAIL</label>
        <label><input type="radio" name="status" value="검토필요" checked> 검토필요</label>
      </div>

      <textarea class="expanded-input opinion-input" placeholder="담당자 의견 작성"></textarea>
    </div>
  </div>
</div>

<script>
  let originalContent = {}; // Object to store the original content for cancel functionality

  // Toggle function for expanding the row
  function toggleRow(button) {
    const row = button.closest('.table-row');
    const toggleButton = row.querySelector('.toggle-button');
    const editButton = row.querySelector('.edit-button');
    const saveButton = row.querySelector('.save-button');
    const cancelButton = row.querySelector('.cancel-button');
    const expandedContent = row.querySelector('.expanded-content');
    const departmentCell = row.querySelector('[data-default="부서명"]');
    const statusCell = row.querySelector('[data-default="검토필요"]');
    const opinionCell = row.querySelector('[data-default="담당자 의견 작성"]');
    const departmentInput = row.querySelector('.department-input');
    const opinionInput = row.querySelector('.opinion-input');
    
    row.classList.toggle('expanded');
    expandedContent.style.display = row.classList.contains('expanded') ? 'flex' : 'none';

    if (row.classList.contains('expanded')) {
      // Store original content when expanded
      originalContent = {
        department: departmentCell.textContent,
        status: statusCell.textContent,
        opinion: opinionCell.textContent
      };
      // Set input fields with original values
      departmentInput.value = originalContent.department;
      opinionInput.value = originalContent.opinion;

      // Set the corresponding radio button based on the status value
      row.querySelector(`input[name="status"][value="${originalContent.status}"]`).checked = true;

      // Hide toggle and edit buttons, show save and cancel buttons
      toggleButton.style.display = 'none';
      editButton.style.display = 'none';
      saveButton.style.display = 'inline-block';
      cancelButton.style.display = 'inline-block';
    } else {
      // Revert buttons when collapsed
      toggleButton.style.display = 'inline-block';
      editButton.style.display = 'inline-block';
      saveButton.style.display = 'none';
      cancelButton.style.display = 'none';
    }
  }

  // Save content and revert buttons
  function saveContent(button) {
    const row = button.closest('.table-row');
    const departmentCell = row.querySelector('[data-default="부서명"]');
    const statusCell = row.querySelector('[data-default="검토필요"]');
    const opinionCell = row.querySelector('[data-default="담당자 의견 작성"]');
    const departmentInput = row.querySelector('.department-input');
    const opinionInput = row.querySelector('.opinion-input');
    const selectedStatus = row.querySelector('input[name="status"]:checked').value;
    
    // Save input values back to cells
    departmentCell.textContent = departmentInput.value;
    statusCell.textContent = selectedStatus;
    opinionCell.textContent = opinionInput.value;

    toggleRow(button); // Collapse the row and show original buttons
    checkButtonVisibility(row);
  }

  // Cancel edit and revert to original content
  function cancelEdit(button) {
    const row = button.closest('.table-row');
    const departmentInput = row.querySelector('.department-input');
    const opinionInput = row.querySelector('.opinion-input');

    // Revert input values to original content
    departmentInput.value = originalContent.department;
    opinionInput.value = originalContent.opinion;
    row.querySelector(`input[name="status"][value="${originalContent.status}"]`).checked = true;

    toggleRow(button); // Collapse the row and show original buttons
    checkButtonVisibility(row);
  }

  // Check whether to show the toggle button or edit button based on content
  function checkButtonVisibility(row) {
    const toggleButton = row.querySelector('.toggle-button');
    const editButton = row.querySelector('.edit-button');
    const departmentCell = row.querySelector('[data-default="부서명"]');
    const statusCell = row.querySelector('[data-default="검토필요"]');
    const opinionCell = row.querySelector('[data-default="담당자 의견 작성"]');
    const authorCell = row.querySelector('[data-default="김피코"]');
    const dateCell = row.querySelector('[data-default="2024-09-05 11:00"]');
    
    // Show toggle button only if all fields are empty, otherwise show edit button
    if (!departmentCell.textContent.trim() && !statusCell.textContent.trim() && 
        !opinionCell.textContent.trim() && !authorCell.textContent.trim() &&
        !dateCell.textContent.trim()) {
      toggleButton.style.display = 'inline-block';
      editButton.style.display = 'none';
    } else {
      toggleButton.style.display = 'none';
      editButton.style.display = 'inline-block';
    }
  }

  // Initial check for button visibility
  document.querySelectorAll('.table-row').forEach(row => checkButtonVisibility(row));
</script>

</body>
</html>
